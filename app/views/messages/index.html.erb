<h1>Chat</h1>

<ul id="chat">
  <%= render :partial => 'message', collection: @messages %>
</ul>
  
<%= form_for Message.new, remote: true do |f| %>
  <%= f.text_field :body %>
  <%= f.hidden_field :user_id, value: current_user.id  %>
  <%= f.submit "Send" %>
<% end %>

<%= subscribe_to "/messages/new" %>

<script type="text/javascript">
  <% publish_to "/messages/new" do %>
    console.log('heroku\'s a brat');
    $("#chat").append("<%= j render(@message) %>");
    $("#new_message")[0].reset();
  <% end %>
</script>