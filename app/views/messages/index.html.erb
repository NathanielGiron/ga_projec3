<h1> Known Messages </h1>

<% if @messages.length === 0 %>
  <h2>No messages yet. Get the conversation started! </h2>
<% else %>
  <% @messages.each do |message| %>
    <h2> <%= message.user.email %> : <a href="/messages/<%= message.id %>"><%= message.message %></a></h2>
  <% end %>
<% end %>

<%= link_to 'New Message', new_message_path, remote: true %>


<head>
  <title>Pusher Test</title>
  <script src="https://js.pusher.com/3.1/pusher.min.js"></script>
  <script>

    // Enable pusher logging - don't include this in production
    Pusher.logToConsole = true;

    var pusher = new Pusher('a26a43a4d594161cec60', {
      encrypted: true
    });

    var channel = pusher.subscribe('test_channel');
    channel.bind('my_event', function(data) {
      alert(data.message);
    });
  </script>
</head>

<h2>Your PUSHER messages</h2>

<% if @messages.any? %>
<%= render :partial => @messages %>
<% else %>
<p>How sad, you have no messages.</p>
<% end %>